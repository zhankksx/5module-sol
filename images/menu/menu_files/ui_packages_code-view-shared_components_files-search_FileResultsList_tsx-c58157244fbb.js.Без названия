"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["ui_packages_code-view-shared_components_files-search_FileResultsList_tsx"],{88947:(e,t,r)=>{r.r(t),r.d(t,{FileResultRow:()=>M,default:()=>$});var l=r(48055),a=r(211),s=r(86525),i=r(23180),n=r(79842),o=r(52674),c=r(15429),u=r(22326),d=r(77461),f=r(51952),h=r(85193),m=r(26935),x=r(13275),p=r(85529),g=r(17840),v=r(42483),y=r(51461),b=r(52972),w=r(73290),C=r(2708),R=r(74121),E=r(98833),j=r(97011),S=r(47142),N=r(58081),F=r(28114),L=r(15205);let I=(0,L.Z)(S.Gs);function A({data:e}){let{query:t,baseList:r,startTime:l}=e,a=t.replaceAll("\\","");return{query:t,list:r.filter(e=>""===a||(0,S.CD)(a,e)&&I(a,e)>0).sort((e,t)=>I(a,t)-I(a,e)),baseCount:r.length,startTime:l}}var _=r(21573),k=r(87623);async function T(e){let t=await (0,k.v)(e);return t.ok?await t.json():void 0}let Z=new Map,D=(0,L.Z)(T,{cache:Z});function $({onRenderRow:e,onItemSelected:t,searchBoxRef:r,sx:d={},...p}){let{query:R,setQuery:E}=(0,a.aM)(),j=(0,o.H)(),S=N.useRef(null),L=r??S,[I,k]=N.useState(R.length>0),[T,Z]=N.useState(!!R),{list:$,directories:M,loading:O,error:q}=function(e){let t=(0,o.H)(),{refInfo:r}=(0,s.Br)(),[l,a]=(0,N.useState)({list:[],directories:[],loading:!0}),i=(0,u.a_)({repo:t,commitOid:r.currentOid,includeDirectories:!0});return(0,N.useEffect)(()=>{let t=!1,r=async()=>{a({list:[],directories:[],loading:!0});let e=await D(i);if(t)return;let r=e?.paths||[],l=e?.directories||[];a({list:r.concat(l).sort(),directories:l,error:!e})};return e&&r(),function(){t=!0}},[i,e]),l}(I),{path:z}=(0,s.Br)(),{findFileWorkerPath:G}=(0,s.Ou)(),{getUrl:V}=(0,n.B)(),{queryText:K,queryLine:P}=function(e){let t=(e=e.replaceAll(" ","")).indexOf(":");return t>=0?{queryText:e.substring(0,t),queryLine:parseInt(e.substring(t+1),10)}:{queryText:e,queryLine:void 0}}(R),{matches:W,clearMatches:U}=function(e,t,r,l){let[a,s]=N.useState(),n=N.useRef(""),o=N.useRef(),{sendStats:c}=(0,i.a)(),u=N.useRef(!1),d=N.useCallback(()=>{let e=new F.V(r,A);e.onmessage=({data:e})=>{u.current=!1,s(e.list),n.current=e.query,e.startTime&&c("repository.find-file",{"find-file-base-count":e.baseCount,"find-file-results-count":e.list.length,"find-file-duration-ms":performance.now()-e.startTime})},o.current=e},[c,r]);return N.useEffect(()=>{if(l)return d(),function(){o.current?.terminate()}},[d,l]),N.useEffect(()=>{if(e.length&&t){u.current&&(o.current?.terminate(),d());let r=n.current&&t.startsWith(n.current);u.current=!0,o.current?.postMessage({baseList:r&&a||e,query:t,startTime:performance.now()})}},[e,t,d]),{matches:a,clearMatches:()=>s(void 0)}}($,K,G,I),{sendRepoClickEvent:Y}=(0,i.a)(),Q=(0,h.s)(),[X,J]=N.useState(0),[ee,et]=N.useState((0,_.$)()),er=N.useRef(null),el=N.useRef(null),ea="file-results-list",{sendRepoKeyDownEvent:es}=(0,i.a)(),{screenSize:ei}=(0,f.eI)(),en=p.useOverlay||ei>=f._G.large,eo=N.useCallback(()=>{Y("FILE_TREE.SEARCH_RESULT_CLICK"),t?.(),Z(!1)},[Y,t]),{containerRef:ec}=(0,g.v)({bindKeys:m.Qw.ArrowVertical|m.Qw.HomeAndEnd,focusInStrategy:"previous"},[O,q]);N.useEffect(()=>{R||Z(!1)},[R]),N.useEffect(()=>{document.activeElement!==L.current&&en&&Z(!1)},[z,L,en]);let eu=W?.slice(0,40)||[],ed=W&&W.length>eu.length,ef=(0,l.jsx)(v.Z,{sx:{maxHeight:en?"60vh":"100% !important",overflowY:"auto",scrollbarGutter:"stable",maxWidth:"100vw","@media (max-width: 768px)":{ml:3,mr:2}},children:q?(0,l.jsx)(y.Z,{variant:"danger",className:"m-3",children:"Failed to search"}):(0,l.jsxs)(b.S,{ref:ec,sx:{overflow:"auto",p:en?2:3,width:"100%",pr:en?3:0,pt:en?3:"2px !important"},role:"listbox",children:[!O&&eu.map((t,r)=>{let a=M.includes(t);return(0,l.jsx)(B,{active:t===z,index:r,focused:ee&&X===r,match:t,onRender:e,query:K,onClick:eo,isDirectory:a,to:V({path:t,action:a?"tree":"blob",hash:P?`L${P}`:""}),useOverlay:en,listRef:ec},t)}),(0,l.jsxs)("div",{className:"m-3 text-center",children:[(0,l.jsx)(H,{loading:O||!W,visibleResultCount:eu.length,truncated:!!ed}),ed&&(0,l.jsxs)(l.Fragment,{children:["\xa0",(0,l.jsx)(w.Z,{id:"see-all-results-link",className:"focus-visible",ref:er,href:(0,u.mY)({owner:j.ownerLogin,repo:j.name,searchTerm:`path:${K}`}),sx:ee&&X===eu.length?{outline:"2px solid var(--focus-outlineColor, var(--color-accent-fg))",outlineOffset:"-2px",boxShadow:"none"}:{},children:"See all results"})]})]})]})});return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(v.Z,{ref:el,sx:{mx:2,ml:3,...d},children:(0,l.jsx)(_.f,{ariaActiveDescendant:(!en&&R||en&&T)&&ee&&X>-1?ed&&X===eu.length?"see-all-results-link":`file-result-${X}`:void 0,ariaExpanded:en?T:void 0,ariaHasPopup:en,ariaControls:en?ea:void 0,ref:L,query:R,onKeyDown:e=>{let{key:t,shiftKey:r,metaKey:l,altKey:a,ctrlKey:s}=e;if(!r&&!l&&!a){if("Escape"===t)R?(es("FILE_TREE.CANCEL_SEARCH"),E(""),U()):document.activeElement&&document.activeElement.blur();else if(!R)return;else if("Enter"===t)ed&&X===eu.length?Q((0,u.mY)({owner:j.ownerLogin,repo:j.name,searchTerm:`path:${K}`})):eu[X]&&(Q(V({path:eu[X],action:"blob",hash:P?`L${P}`:""})),Z(!1));else if("ArrowDown"===t||s&&"n"===t){if(ed&&X>=eu.length-1){if(J(eu.length),er.current&&ec.current){let e=(0,c.M)(ec.current);(0,x.z)(er.current,e,{behavior:"instant"})}}else J(Math.min(X+1,eu.length-1));e.preventDefault();return}else if("ArrowUp"===t||s&&"p"===t){J(Math.max(X-1,0)),e.preventDefault();return}}},onPreload:()=>k(!0),onSearch:e=>{E(e),e?Z(!0):(U(),Z(!1)),J(0)},onBlur:e=>{ec.current?.contains(e.relatedTarget)||(Z(!1),et(!1))},onFocus:()=>{R&&Z(!0),et(!0)},sx:{minWidth:"160px"}})}),en&&(0,l.jsx)(C.w,{anchorRef:el,open:en&&T,renderAnchor:null,onClose:()=>{Z(!1)},focusZoneSettings:{disabled:!0},focusTrapSettings:{disabled:!0},width:"xlarge",align:"end",overlayProps:{id:ea,role:"dialog"},children:ef}),!en&&R&&ef]})}function H({visibleResultCount:e,truncated:t,loading:r}){return(0,l.jsx)("span",{role:"status",className:r||t||0===e?void 0:"sr-only","aria-label":r?"Loading":void 0,children:r?(0,l.jsx)(R.Z,{size:"large"}):0===e?"No matches found":t?`First ${e} files shown.`:`Showing ${e} files.`},"results-count-status")}let M=({active:e,focused:t,index:r,match:a,query:s,to:i,isDirectory:n,onClick:o,onRender:u,useOverlay:f,listRef:h})=>{let m=(0,S.m7)(s,a);u?.();let p=N.useRef(null),g=n?O:q;N.useEffect(()=>{if(t&&p.current&&h?.current){let e=(0,c.M)(h.current);(0,x.z)(p.current,e,{behavior:"instant"})}},[t,h]);let y={};return t&&(y={outline:"none",border:"2 solid",boxShadow:"0 0 0 2px #0969da"}),(0,l.jsx)(b.S.Item,{id:`file-result-${r}`,ref:p,as:d.r,onSelect:o,to:i,active:e,sx:{fontWeight:"normal",":hover":{textDecoration:"none"},mx:"2px",width:"calc(100% - 4px)",...y},role:"option","data-focus-visible-added":t||void 0,tabIndex:f?-1:0,children:(0,l.jsxs)("div",{className:"d-flex",children:[(0,l.jsx)("div",{className:"d-flex flex-1 flex-column overflow-hidden",children:(0,l.jsx)(z,{text:a,positionsList:m,sx:{color:"fg.muted"},LeadingIcon:g})}),t&&(0,l.jsx)(v.Z,{sx:{pl:1,whiteSpace:"nowrap",color:"fg.muted"},children:`Go to ${n?"folder":"file"}`})]})},a)},O=()=>(0,l.jsx)(E.Z,{"aria-label":"Directory",icon:p.FileDirectoryFillIcon,sx:{color:"var(--treeViewItem-leadingVisual-iconColor-rest, var(--color-icon-directory))",mr:2},size:"small"}),q=()=>(0,l.jsx)(E.Z,{"aria-label":"File",icon:p.FileIcon,className:"fgColor-muted mr-2",size:"small"}),B=N.memo(M);function z({text:e,positionsList:t,sx:r,LeadingIcon:a}){let s=[],i=0;for(let r of t){if(Number(r)!==r||r<i||r>e.length)continue;let t=e.slice(i,r);t&&s.push(G(t)),i=r+1,s.push((0,l.jsx)(j.Z,{as:"mark",className:"text-bold bgColor-transparent fgColor-default",children:e[r]},r))}return s.push(G(e.slice(i))),(0,l.jsx)(v.Z,{sx:r,children:(0,l.jsxs)(l.Fragment,{children:[a&&(0,l.jsx)(a,{}),s]})})}function G(e){return e.replaceAll("/","/\u200B")}try{$.displayName||($.displayName="FileResultsList")}catch{}try{H.displayName||(H.displayName="FileResultsStatus")}catch{}try{M.displayName||(M.displayName="FileResultRow")}catch{}try{O.displayName||(O.displayName="DirectoryIcon")}catch{}try{q.displayName||(q.displayName="FileResultIcon")}catch{}try{B.displayName||(B.displayName="MemoizedFileResultRow")}catch{}try{z.displayName||(z.displayName="HighlightMatch")}catch{}},21573:(e,t,r)=>{r.d(t,{$:()=>h,f:()=>f});var l=r(48055),a=r(46263),s=r(47357),i=r(23180),n=r(71207),o=r(85529),c=r(14626),u=r(42483),d=r(58081);let f=d.forwardRef(({ariaActiveDescendant:e,ariaControls:t,ariaExpanded:r,ariaHasPopup:n,onBlur:f,onFocus:m,onKeyDown:x,onPreload:p,onSearch:g,query:v,sx:y={}},b)=>{let{sendRepoClickEvent:w}=(0,i.a)(),[C,R]=d.useState(v),E=d.useRef((0,a.D)(e=>g(e),250));d.useEffect(()=>{R(v)},[v]);let j=v?(0,l.jsx)(c.Z.Action,{onClick:()=>{w("FILE_TREE.CANCEL_SEARCH"),g("")},icon:o.XCircleFillIcon,"aria-label":"Clear",className:"fgColor-muted"}):void 0;return(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(c.Z,{autoFocus:h(),ref:b,value:C,onKeyDown:x,onChange:e=>{R(e.target.value),p(),E.current(e.target.value)},sx:{display:"flex",...y},"aria-label":"Go to file","aria-activedescendant":e,role:n?"combobox":void 0,"aria-controls":t,"aria-expanded":r,"aria-haspopup":n?"dialog":void 0,autoCorrect:"off",spellCheck:"false",placeholder:"Go to file",leadingVisual:o.SearchIcon,trailingAction:j,trailingVisual:j?void 0:()=>(0,l.jsx)(s.I,{children:(0,l.jsx)(u.Z,{sx:{mr:"-6px"},children:(0,l.jsx)("kbd",{children:"t"})})}),onFocus:e=>{p(),e.target.select(),m?.(e)},onBlur:f,onClick:()=>w("FILE_TREE.SEARCH_BOX")})})});function h(){return"1"===new URLSearchParams(n.ssrSafeLocation.search).get("search")}f.displayName="FilesSearchBox"}}]);
//# sourceMappingURL=ui_packages_code-view-shared_components_files-search_FileResultsList_tsx-25dc13597202.js.map